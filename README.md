# AlphaCognate

AlphaCognate is a tool for the functional annotation of predicted protein structures via cognate ligand transplantation, enabling large-scale transplantation of ligands with known cognate mappings into predicted structures.

## Installation

To install AlphaCognate, clone the repository and install the required dependencies in a virtual environment (we recommend using [UV](https://docs.astral.sh/uv/getting-started/installation/) for extremly fast installation, but you can also use pip):

```bash
git clone https://github.com/m-crown/AlphaCognate.git
cd AlphaCognate/alphacognate_pipeline
uv venv
uv pip install -r requirements.txt
```

In addition to the Python dependencies, AlphaCognate also requires FoldSeek for structure searching. To install FoldSeek, download the latest appropriate binary file from the [FoldSeek GitHub repo](https://github.com/steineggerlab/foldseek) (example below is shown for Linux with AVX2, binaries are available for Linux ARM64, MacOS and GPU enable - note this is not tested in AlphaCognate).

```bash
cd AlphaCognate/alphacognate_pipeline
source .venv/bin/activate
wget https://mmseqs.com/foldseek/foldseek-linux-avx2.tar.gz && tar xvzf foldseek-linux-avx2.tar.gz &&  export PATH=$(pwd)/foldseek/bin/:$PATH
```

For MacOS, the command is slightly different (note that the binary is universal and will work on both Intel and M1/M2 Macs):

```bash
cd AlphaCognate/alphacognate_pipeline
source .venv/bin/activate
wget https://mmseqs.com/foldseek/foldseek-osx-universal.tar.gz && tar xvzf foldseek-osx-universal.tar.gz &&  export PATH=$(pwd)/foldseek/bin:$PATH
```

Finally, check that FoldSeek is installed correctly

```bash
foldseek --version
```

## Pre-requisites

AlphaCognate requires a comma separated manifest file containing the following columns (without a header row):

- structure basename: The basename of the structure, e.g. AF-A0A023GPK8-F1-model_4
- filename: The filename of the structure, e.g. AF-A0A023GPK8-F1-model_4.cif
- directory: The directory containing the structure, e.g. alphafold_structures/

This manifest fle can be generated by using the following helper command and specify the directory in which the structure files are located:

```bash
python3 bin/make_manifest.py $STRUCTURE_DIRECTORY
```

You may also need to download the AlphaFold structure files from the AlphaFold database. This can be done using the following helper command and an input file containing the list of UniProt IDs (one per line):

```bash
python3 bin/get_alphafold_structures.py $UNIPROTIDS_FILE $OUTPUTDIRECTORY
```

The manifest file can then be provided in the Snakemake command (see [Running AlphaCognate](#running-the-alphacognate-pipeline)) either as part of a config file (recommended) or directly as a command line argument e.g.:

```snakemake --configfile config.yaml```
or

```snakemake --config manifest=manifest.csv```

Finally, AlphaCognate requires a domain assignments file which contains the domain boundaries predicted by CATH for the input predicted structures. This file should be a TSV file with the following columns (including a header row):

- accession: The basename of the structure, e.g. AF-A0A023GPK8-F1-model_4 - this should match the structure basename in the manifest file.
- domain_profile: The ID and residue range of the domains predicted in the structure (separated with a colon), with multiple domains semicolon delimited. For example for a structure with a single domain prediction: `2.60.40.10:122-228` and for a structure with multiple domains: `1.10.1380.10:150-448;3.40.390.10:453-765`. Where domains are segmented, multiple ranges are separated with an underscore e.g. `1.10.1380.10:150-448_502-765`.

This file can be provided by the user or generated from CATH domain assignments from either [CATH AlphaFold Model Organisms analysis (2021)](https://zenodo.org/records/7404988) or The Encyclopedia of Domains (TED) using the following helper command:

```bash
cd AlphaCognate/alphacognate_pipeline
source .venv/bin/activate
python3 bin/format_cath_af_domains.py --ted
```

The output directory of this file can be specified using the `--output_dir` flag.

## Running The AlphaCognate Pipeline

To run AlphaCognate, the pipeline is executed with Snakemake. The workflow is designed to be run from the command line and requires the manifest file and domain assignments (see [Pre-requisites](#pre-requisites)) as input.

For the TL;DR version, the following command will run the pipeline with default parameters:

```bash  
snakemake -s alphacognate_pipeline.smk --configfile alphacognate_config.yaml --cores 1
```

AlphaCognate runtime benefits significantly from increased thread count, which helps speed-up both FoldSeek and allow for parallel transplantations. STATEMENT HERE ON RUNTIME WITH X AND Y THREADS.

Note: Files from the ProCogGraph database (see [here](https://pathtopcgpaper.com)) are required for running AlphaCognate. These are downloaded in a preprocessing step of the pipeline, download size:

- 137MB zipped
- 693MB unzipped

Additionally, the pipeline requires the download of the protonated assemblies of structures present in the ProCogGraph mapping. For the demo output, a subset of 45 structures are downloaded (total download size approx. 15MB), but to run the full pipeline against all structures present in the ProCogGraph mapping, approx. 60,000 structures are required. The download size of these files is approx. 15GB.

### Configuration

The pipeline is configured using a YAML file, which can be specified using the `--configfile` option. The configuration file should contain the following parameters:

- `manifest`: The path to the manifest file containing the structure basenames, filenames, and directories.
- `domain_assignments`: The path to the domain assignments file, which should be a CSV file with the following columns:
  - `structure_basename`: The basename of the structure, e.g. AF-A0A023GPK8-F1-model_4
  - `domain_id`: The ID of the domain, e.g. A0A023GPK8
  - `domain_name`: The name of the domain, e.g. "Ligand-binding domain"
  - `ligand_id`: The ID of the cognate ligand, e.g. "ATP"
  - `ligand_name`: The name of the cognate ligand, e.g. "Adenosine triphosphate"

The domain assignments files are pre-generated using the CATH domain assignments from either [CATH AlphaFold Model Organisms analysis (2021)]() or The Encyclopedia of Domains (TED) using the following helper command:

```bash

```

### Structure of the ProCogGraph Mapping File